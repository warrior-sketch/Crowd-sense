import streamlit as st
from streamlit_option_menu import option_menu

# Custom CSS for blue background & attractive styles
st.markdown("""
    <style>
    body {
        background: linear-gradient(135deg, #3a8dde 0%, #1565c0 100%) !important;
    }
    .main {
        background: transparent !important;
    }
    .stTextInput > div > div > input {
        background-color: #e3f2fd !important;
        color: #1565c0 !important;
        font-weight: 600 !important;
        border-radius: .5rem !important;
    }
    .stButton > button {
        background: #1565c0 !important;
        color: white !important;
        border-radius: .5rem !important;
        font-size: 17px !important;
        font-weight: bold !important;
        border: none;
        box-shadow: 0 2px 10px rgba(21,101,192,0.1);
    }
    .stSelectbox > div > div {
        background: #e3f2fd !important;
        color: #1565c0 !important;
        font-weight: 600 !important;
        border-radius: .5rem !important;
    }
    .crowd-bar {
        display: flex;
        gap: 4px;
        margin: 6px 0 12px 0;
        justify-content: center;
    }
    .bar {
        width: 20px;
        height: 40px;
        border-radius: 4px;
        border: 1.5px solid #333;
        display: flex;
        align-items: end;
        justify-content: center;
        font-size: 12px;
        font-weight: bold;
        color: #fff;
    }
    </style>
""", unsafe_allow_html=True)

# Sidebar Menu Navigation
with st.sidebar:
    selected = option_menu("TRAIN APP", ["Route Select", "Available Trains", "Train Live Tracking"],
        icons=['geo-alt', 'train-front', 'bar-chart'],
        menu_icon="cast", default_index=0,
        styles={
            "container": {"background": "#1565c0"},
            "icon": {"color": "white", "font-size": "24px"},
            "nav-link": {"color": "white", "font-size": "18px", "text-align": "left", "margin":"0px", "--hover-color": "#2196f3"},
            "nav-link-selected": {"background-color": "#e3f2fd", "color": "#1565c0"},
        }
    )

# Page 1: Route Selection
if selected == "Route Select":
    st.markdown("<h1 style='color:#fff;'>Select Your Route</h1>", unsafe_allow_html=True)
    st.text_input("From", value="HOWRAH", key="from_station")
    st.text_input("To", value="NALIKUL", key="to_station")
    st.text_input("Train No/Train Name", placeholder="Optional")
    st.text_input("Search History", placeholder="HOWRAH ...")
    if st.button("FIND TRAINS"):
        st.success("Trains Searched! Go to the next page.")

# Page 2: Available Trains
elif selected == "Available Trains":
    st.markdown("<h1 style='color:#fff;'>Available Trains</h1>", unsafe_allow_html=True)
    st.selectbox("All Dates", options=["Today", "Tomorrow"])
    st.selectbox("Sort By", options=["Time", "Name"])
    st.markdown("""
        **HWH-HOWRAH → NKL-NALIKUL**
        - 37353 : 6:10pm - 7:02pm (HOWRAH-TARAKESWAR LOCAL)
        - 33379 : 6:40pm - 7:32pm (HOWRAH-GHOMOHAT LOCAL)
        - 33366 : --:-- (No details)
        - 33341 : --:-- (No details)
        - 33318 : --:-- (No details)
        - 33301 : --:-- (No details)
    """)
    st.info("Select a train to track crowd live on the next page.")

# Page 3: Train Live Tracking & Crowd Detection
else:
    st.markdown("<h1 style='color:#fff;'>Live Train Tracking</h1>", unsafe_allow_html=True)
    st.markdown("""
        <div style="background:#e3f2fd;padding:18px 12px;border-radius:14px;">
        <b>Train:</b> HOWRAH-TARAKESWAR LOCAL (37379)<br>
        <b>Today | Alarm | Share</b><br>
        <b>Arrival:</b> HARIRAL 6:33PM<br>
        <b>Next Stops:</b><br>
        - MALIYA HALT 6:36PM<br>
        - NALIKUL 6:40PM<br>
        - KAMARKUNDU 6:43PM<br>
        - SINGUR 6:45PM<br>
        </div>
    """, unsafe_allow_html=True)
    st.write(" ")
    st.info("Arrived: Hariral (just now) | Updated few seconds ago")
    st.markdown("<h4 style='color:#fff;'>Current Crowd Update</h4>", unsafe_allow_html=True)

    # Static bar crowd levels
    crowd_levels = [2, 3, 4, 5, 7, 8, 8, 5, 3]
    crowd_colors = []
    for lv in crowd_levels:
        if lv >= 7:
            crowd_colors.append('#d32f2f')  # High = Red
        elif lv >= 5:
            crowd_colors.append('#ffc107')  # Medium = Yellow
        else:
            crowd_colors.append('#43a047')  # Low = Green

    st.markdown(
        '<div class="crowd-bar">' +
        ''.join([f'<div class="bar" style="background:{color};height:{20 + lv*9}px">{lv}</div>'
                 for lv, color in zip(crowd_levels, crowd_colors)]) +
        '</div><div style="text-align:center;color:#fff;font-weight:600">← TAIL HWH FRONT →</div>',
        unsafe_allow_html=True,
    )

    st.write("""
        <span style='color:#fff'>
        <b>Legend: </b>
        <span style='background:#d32f2f;color:#fff;padding:2px 7px;border-radius:4px;'>High</span>
        <span style='background:#ffc107;color:#222;padding:2px 7px;border-radius:4px;'>Medium</span>
        <span style='background:#43a047;color:#fff;padding:2px 7px;border-radius:4px;'>Low</span>
        </span>
    """, unsafe_allow_html=True)
